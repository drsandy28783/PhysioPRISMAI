{% extends "base.html" %}
{% block title %}Patient List â€“ Physiologic PRISM{% endblock %}

{% block head %}
<style>
  .filter-form { margin-bottom: 16px; }
  .debug-info { background: #f0f0f0; padding: 10px; margin: 5px 0; font-size: 12px; }
</style>
{% endblock %}

{% block content %}
  <div class="container">
    <h2>Patient List (Debug Mode)</h2>

    <form method="GET" class="filter-form">
      <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap;">
        <label>Filter by Name:
          <input type="text" name="name" placeholder="Enter Name" value="{{ request.args.get('name', '') }}">
        </label>
        <label>Filter by Patient ID:
          <input type="text" name="patient_id" placeholder="Enter ID" value="{{ request.args.get('patient_id', '') }}">
        </label>
        <button type="submit" class="button">Apply Filters</button>
      </div>
    </form>

    {% if patients %}
    <p><strong>Found {{ patients|length }} patients</strong></p>
    
    {% for patient in patients %}
    <div style="border: 1px solid #ccc; margin: 10px 0; padding: 15px;">
      <h4>Patient {{ loop.index }}</h4>
      
      <!-- Show what we expect -->
      <div>
        <strong>Expected Data:</strong><br>
        ID: {{ patient.patient_id or patient.doc_id or 'N/A' }}<br>
        Name: {{ patient.name or 'NOT FOUND' }}<br>
        Age/Sex: {{ patient.age_sex or 'NOT FOUND' }}<br>
        Contact: {{ patient.contact or 'NOT FOUND' }}<br>
        Created: {{ patient.created_at or 'NOT FOUND' }}<br>
      </div>
      
      <!-- Show ALL available data -->
      <div class="debug-info">
        <strong>All Available Fields:</strong><br>
        {% for key, value in patient.items() %}
          <strong>{{ key }}:</strong> {{ value }}<br>
        {% endfor %}
      </div>
      
      <div style="margin-top: 10px;">
        <a href="{{ url_for('edit_patient', patient_id=patient.patient_id or patient.doc_id) }}" class="button">Edit</a>
        <a href="{{ url_for('follow_ups', patient_id=patient.patient_id or patient.doc_id) }}" class="button green">Add Follow-Up</a>
        <a href="{{ url_for('view_follow_ups', patient_id=patient.patient_id or patient.doc_id) }}" class="button green">View Follow-Ups</a>
        <a href="{{ url_for('patient_report', patient_id=patient.patient_id or patient.doc_id) }}" class="button">Report</a>
        <a href="{{ url_for('download_report', patient_id=patient.patient_id or patient.doc_id) }}" class="button">PDF</a>
      </div>
    </div>
    {% endfor %}
    
    {% else %}
    <div style="text-align: center; padding: 40px;">
      <h3>No patients found</h3>
      <p>You haven't added any patients yet, or no patients match your search criteria.</p>
      <a href="{{ url_for('add_patient') }}" class="button">Add Your First Patient</a>
    </div>
    {% endif %}

    <div style="margin-top: 24px;">
      <a href="{{ url_for('dashboard') }}" class="button">&larr; Back to Dashboard</a>
    </div>
  </div>
{% endblock %}